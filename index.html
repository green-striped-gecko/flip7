<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Score Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f7faff;
      color: #333;
      margin: 0;
      padding: 10px;
    }

    .main-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }

    .players-column {
      display: flex;
      flex-direction: column;
      gap: 10px;
      width: 100%;
      max-width: 500px;
    }

    .player {
      border: 2px solid #ccc;
      border-radius: 10px;
      padding: 6px;
      background: #fff;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 6px;
    }

    .player.selected {
      border-color: #3498db;
      background-color: #e8f4fd;
    }

    .player-info {
      flex-grow: 1;
      font-size: 0.95em;
      text-align: left;
    }

    .score-line {
      font-size: 1.5em;
      font-weight: bold;
      line-height: 1;
    }

    .queued-points {
      font-size: 1em;
      color: #27ae60;
      line-height: 1;
    }

    .btn-action {
      font-size: 1.2em;
      padding: 10px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      min-width: 44px;
    }

    .btn-add { background-color: #e17055; color: white; }
    .btn-add:hover { background-color: #d35400; }

    .btn-delete { background-color: #636e72; color: white; }
    .btn-delete:hover { background-color: #2d3436; }

    .button-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 6px;
      width: 100%;
    }

    .button-grid button,
    .double-button button,
    .action-buttons button,
    .player-manage-buttons button {
      font-size: 1.1em;
      padding: 10px;
      border-radius: 10px;
      background-color: #6c5ce7;
      color: white;
      border: none;
      cursor: pointer;
      transition: transform 0.1s ease;
    }

    .button-grid button:active,
    .double-button button:active,
    .action-buttons button:active,
    .player-manage-buttons button:active {
      transform: scale(0.95);
      background-color: #341f97;
    }

    .double-button,
    .action-buttons,
    .player-manage-buttons {
      width: 100%;
    }

    .action-buttons, .player-manage-buttons {
      display: flex;
      justify-content: space-between;
      gap: 6px;
    }
  </style>
</head>
<body>

<div class="players-column" id="players"></div>
<div class="button-grid" id="buttonGrid"></div>
<div class="double-button">
  <button onclick="doubleQueue()">√ó2</button>
</div>
<div class="action-buttons">
  <button onclick="undo()">‚Ü©Ô∏è Undo</button>
  <button onclick="resetAll()">üîÑ Reset</button>
</div>
<div class="player-manage-buttons">
  <button onclick="addPlayer()">‚ûï Add Player</button>
  <button onclick="deletePlayer()">üóëÔ∏è Delete Player</button>
</div>

<script>
  let playerNames = ['Alica', 'Bernd', 'Jonas', 'Mattis'];
  let scores = playerNames.map(() => 0);
  let queue = [];
  let history = playerNames.map(() => []);
  let currentPlayer = 0;

  function renderPlayers() {
    const container = document.getElementById("players");
    container.innerHTML = '';
    for (let i = 0; i < playerNames.length; i++) {
      const div = document.createElement("div");
      div.className = "player" + (i === currentPlayer ? " selected" : "");
      div.onclick = () => selectPlayer(i);
      div.innerHTML = `
        <button class="btn-action btn-delete" onclick="deleteLast(event)">‚àí</button>
        <div class="player-info">
          <strong>${playerNames[i]}</strong>
          <div class="score-line" id="score${i}">${scores[i]}</div>
          <div class="queued-points" id="queued${i}"></div>
        </div>
        <button class="btn-action btn-add" onclick="applyPoints(event)">+</button>
      `;
      container.appendChild(div);
    }
    updateQueuedDisplay();
  }

  function renderButtons() {
    const grid = document.getElementById("buttonGrid");
    grid.innerHTML = '';
    for (let i = 1; i <= 12; i++) {
      const btn = document.createElement("button");
      btn.textContent = i;
      btn.onclick = () => {
        addToQueue(i);
        if (navigator.vibrate) navigator.vibrate(30);
      };
      grid.appendChild(btn);
    }
  }

  function addToQueue(val) {
    queue.push(val);
    updateQueuedDisplay();
  }

  function doubleQueue() {
    if (navigator.vibrate) navigator.vibrate(50);
    queue = queue.map(x => x * 2);
    updateQueuedDisplay();
  }

  function updateQueuedDisplay() {
    for (let i = 0; i < playerNames.length; i++) {
      const el = document.getElementById(`queued${i}`);
      el.innerText = (i === currentPlayer && queue.length > 0) ? '+ ' + queue.join(' + ') : '';
    }
  }

  function applyPoints(e) {
    e.stopPropagation();
    const total = queue.reduce((a, b) => a + b, 0);
    if (total > 0) {
      scores[currentPlayer] += total;
      history[currentPlayer].push([...queue]);
      queue = [];
      currentPlayer = (currentPlayer + 1) % playerNames.length;
      renderPlayers();
      renderButtons();
    }
  }

  function deleteLast(e) {
    e.stopPropagation();
    if (queue.length > 0) {
      queue.pop();
      updateQueuedDisplay();
    }
  }

  function undo() {
    if (history[currentPlayer].length > 0) {
      const last = history[currentPlayer].pop();
      const sum = last.reduce((a, b) => a + b, 0);
      scores[currentPlayer] -= sum;
      renderPlayers();
    }
  }

  function resetAll() {
    scores = playerNames.map(() => 0);
    history = playerNames.map(() => []);
    queue = [];
    renderPlayers();
  }

  function selectPlayer(i) {
    currentPlayer = i;
    queue = [];
    renderPlayers();
    renderButtons();
  }

  function addPlayer() {
    const newName = window.prompt("Enter new player name:");
    if (newName && newName.trim().length > 0) {
      playerNames.push(newName.trim());
      scores.push(0);
      history.push([]);
      renderPlayers();
      renderButtons();
    }
  }

  function deletePlayer() {
    if (playerNames.length > 1) {
      playerNames.splice(currentPlayer, 1);
      scores.splice(currentPlayer, 1);
      history.splice(currentPlayer, 1);
      currentPlayer = currentPlayer % playerNames.length;
      renderPlayers();
      renderButtons();
    } else {
      alert("At least one player must remain.");
    }
  }

  renderPlayers();
  renderButtons();
</script>

</body>
</html>
